"use strict";function PlacePolyline(e,i){this._container=e;var t=document.createElement("div");t.classList.add("dataEarth-polylineLayer"),t.style.display="none",e.appendChild(t);t.innerHTML="<dl>      <dt>符号</dt>      <dd class=\"signal\"><div class='polylineCreate'><a class='current'  data-bind='click: drawingPolyline, css: { current: _ActiveType === PolylineType.PolylineColor }' title='直线'></a><a data-bind='click: drawingPolylineDash, css: { current: _ActiveType === PolylineType.PolylineDash }' title='虚线'></a><a data-bind='click: drawingPolylineArrow, css: { current: _ActiveType === PolylineType.PolylineArrow }' title='箭头线'></a><a data-bind='click: drawingPolylineOutline, css: { current: _ActiveType === PolylineType.PolylineOutline }' title='边框线'></a><a data-bind='click: drawingPolylineGlow, css: { current: _ActiveType === PolylineType.PolylineGlow }' title='发光线'></a></div>"+'        <div class="checkBox" style="padding: 0px 10px 5px;">          <input type="checkbox" id="polylineCheck" data-bind="checked: !cameraController, event: { change: cameraControllerChange }">           <label for="polylineCheck" class="lightObj">连续绘制</label>        </div></dd>    </dl>    <dl><dl>      <dt>操作</dt>      <dd class="option"><div class=\'polylineEdit\'><a data-bind=\'click: setEditType(PolylineEditType.EA_HANDLE_MOVE), css: { current: _editType === PolylineEditType.EA_HANDLE_MOVE}\'>平移节点</a><a data-bind=\'click: setEditType(PolylineEditType.EA_HANDLE_MOVE_Z), css: { current: _editType === PolylineEditType.EA_HANDLE_MOVE_Z}\'>升降节点</a><a data-bind=\'click: setEditType(PolylineEditType.EA_POLYLINE_MOVE_Z), css: { current: _editType === PolylineEditType.EA_POLYLINE_MOVE_Z}\'>升降对象</a></div></dd>    </dl>    <dl><dl>      <dt>名称</dt>      <dd><input type="text" class="elementName" data-bind="value: polylineName, event: {input: modifyPolylineName}, valueUpdate: \'input\'"></dd>    </dl>    <dl>      <dt>填充</dt>      <dd>        <div class=\'pickerWrap\'>          颜色 <span class="colorPicker"><span id="polylineColor"></span><label for="" data-bind="text: polylineColor"></label></span>          宽度 <input type="number" data-bind="value: width, event: {input: modifyPolylineWidth}, valueUpdate: \'input\'">        </div>        <div class=\'sliderWrap\'>          不透明度 <span id="polylineAlpha" class="sliderAlpha"></span>        </div>      </dd>    </dl>    <dl data-bind=\'style:{display: isOutlinePolyline }\'>        <dt>边框</dt>        <dd>          <div class=\'pickerWrap\'>            颜色 <span class="colorPicker"><span id="outlinePolylineColor"></span><label for="" data-bind="text: outlinePolylineColor"></label></span>            宽度 <input type="number" data-bind="value: outlineWidth, event: {input: modifyPolylineOutlineWidth}, valueUpdate: \'input\'">          </div>          <div class=\'sliderWrap\'>            不透明度 <span id="outlinePolylineAlpha" class="sliderAlpha"></span>          </div>        </dd>      </dl>    <dl data-bind=\'style:{display: isGlowPowerPolyline}\'>        <dt>其他样式</dt>        <dd>          <div class=\'sliderWrap\'>            发光强度 <span id="glowPower" class="sliderAlpha"></span>          </div>        </dd>      </dl>';var l=new PlacePolylineViewModel(i.scene,i,t);this._element=t,this._viewModel=l,Cesium.knockout.applyBindings(this._viewModel,t)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Cesium.defineProperties(PlacePolyline.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),PlacePolyline.prototype.isDestroyed=function(){return!1},PlacePolyline.prototype.destroy=function(){return Cesium.knockout.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),destroyObject(this)};var ActiveType,polylineColorPicker,polylineColorSlider,outlinePolylineColorPicker,outlinePolylineAlphaSlider,glowPowerSlider,ellipsoid=Cesium.Ellipsoid.WGS84,PolylineEditorAction={CREATE:0,EDIT:2,NONE:5},PolylineType={PolylineColor:0,PolylineOutline:1,PolylineArrow:2,PolylineDash:3,PolylineGlow:4},PolylineEditType={EA_HANDLE_MOVE:0,EA_HANDLE_MOVE_Z:1,EA_POLYLINE_MOVE_Z:2,NONE:3},PolylineChangeablePrimitive=function(){function e(){}return e.prototype.initialiseOptions=function(e){fillOptions(this,e),this._ellipsoid=void 0,this._id=void 0,this._classificationType=void 0,this._createPlacePolylinePrimitive=!0,this._primitive=void 0},e.prototype.setAttribute=function(e,i){this[e]=i,this._createPlacePolylinePrimitive=!0},e.prototype.getAttribute=function(e){return this[e]},e.prototype.update=function(e){if(!Cesium.defined(this.ellipsoid))throw new Cesium.DeveloperError("this.ellipsoid must be defined.");if(!Cesium.defined(this.appearance))throw new Cesium.DeveloperError("this.material must be defined.");if(this.show&&(this._createPlacePolylinePrimitive||Cesium.defined(this._primitive))){if(this._createPlacePolylinePrimitive||this._ellipsoid!==this.ellipsoid||this._id!==this.id){var i=this.getGeometry();if(!i)return;if(this._createPlacePolylinePrimitive=!1,this._ellipsoid=this.ellipsoid,this._id=this.id,this._classificationType=this.classificationType,this._primitive=this._primitive&&this._primitive.destroy(),null!=this._classificationType?this._primitive=new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:i,id:this.id,pickPrimitive:this,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(this.material.uniforms.color)}}),appearance:this.appearance,asynchronous:this.asynchronous,classificationType:Cesium.ClassificationType.CESIUM_3D_TILE}):(this.appearance.material=this._viewModel._defaultMaterial,this._primitive=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:i,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous})),Cesium.defined(this._selectedEntity)){for(var t=[],l=0;l<this.positions.length;l++)t.push(this.positions[l].clone());Cesium.defined(this._viewModel.defaultPolylineOptions.classificationType)?this._selectedEntity.corridor.positions.setValue(t):this._selectedEntity.polyline.positions.setValue(t)}}var n=this._primitive;n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.update(e)}},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Cesium.destroyObject(this)},e}(),PlacePolylinePrimitive=function(){function e(e){this.initialiseOptions(e)}return(e.prototype=new PolylineChangeablePrimitive).setPositions=function(e){this.setAttribute("positions",e)},e.prototype.setWidth=function(e){this.setAttribute("width",e)},e.prototype.setGeodesic=function(e){this.setAttribute("geodesic",e)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.getWidth=function(){return this.getAttribute("width")},e.prototype.getGeodesic=function(e){return this.getAttribute("geodesic")},e.prototype.offsetZ=function(e){if(Cesium.defined(this.positions)&&!(this.positions.length<3))for(var i=0;i<this.positions.length;i++){var t=Cesium.Cartographic.fromCartesian(this.positions[i]);t.height+=e,this.positions[i]=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height)}},e.prototype.getGeometry=function(){if(Cesium.defined(this.positions)&&!(this.positions.length<2)){for(var e=[],i=0;i<this.positions.length;i++)e.push(this.positions[i].clone());return null!=this.classificationType?new Cesium.CorridorGeometry({positions:e,width:this.width/100,vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT}):new Cesium.PolylineGeometry({positions:e,height:this.height,width:this.width<1?1:this._viewModel.width,vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})}},e}();function PlacePolylineViewModel(e,i,t){this.ellipsoid=Cesium.Ellipsoid.WGS84;var l=e.canvas;this._eventHandler=void 0,this._scene=e,this._canvas=l,this._viewer=i,this._element=t,this.cameraController=!0,this._selectedEntity=null,this._onCreatedEvent=new Cesium.Event,this._onEditHandleMoveEvent=new Cesium.Event,this._editAction=PolylineEditorAction.NONE,this._editType=PolylineEditType.NONE,this._ActiveType=PolylineType.PolylineColor,Cesium.knockout.track(this,["polylineName","polylineColor","outlinePolylineColor","width","outlineWidth","glowPower","isGlowPowerPolyline","isOutlinePolyline","_selectedEntity","_editType","cameraController","_ActiveType"]),this.polylineName="未命名的线",this.polylineColor="#ffff00",this.polylineAlpha=1,this.outlinePolylineColor="#ff0000",this.outlinePolylineAlpha=1,this.width=5,this.outlineWidth=2,this.glowPower=.2,this.isGlowPowerPolyline="none",this.isOutlinePolyline="none";var n=this;$(document).ready(function(){var e={preview:!0,opacity:!1,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}};polylineColorPicker=Pickr.create({el:"#polylineColor",default:n.polylineColor,components:e,strings:{save:"保存"},onSave:function(e,i){n.polylineColor=e.toHEX().toString(),void 0!==ActiveType&&n.setPolylineType(ActiveType),n.modifyPolylineColor(e.toHEX().toString())}}),outlinePolylineColorPicker=Pickr.create({el:"#outlinePolylineColor",default:n.outlinePolylineColor,components:e,strings:{save:"保存"},onSave:function(e,i){n.outlinePolylineColor=e.toHEX().toString(),ActiveType===PolylineType.PolylineOutline&&n.setPolylineType(ActiveType),n.modifyPolylineOutlineColor(e.toHEX().toString())}})}),layui.use("slider",function(){var e=layui.slider;polylineColorSlider=e.render({elem:"#polylineAlpha",value:100,setTips:function(e){return e+"%"},change:function(e){n.polylineAlpha=parseInt(e)/100,void 0!==ActiveType&&n.setPolylineType(ActiveType),n.modifyPolylineAlpha(parseInt(e)/100)}})}),layui.use("slider",function(){var e=layui.slider;outlinePolylineAlphaSlider=e.render({elem:"#outlinePolylineAlpha",value:100,setTips:function(e){return e+"%"},change:function(e){n.outlinePolylineAlpha=parseInt(e)/100,ActiveType===PolylineType.PolylineOutline&&n.setPolylineType(ActiveType),n.modifyPolylineOutlineAlpha(parseInt(e)/100)}})}),layui.use("slider",function(){var e=layui.slider;glowPowerSlider=e.render({elem:"#glowPower",value:20,setTips:function(e){return e+"%"},change:function(e){n.glowPower=parseInt(e)/100,ActiveType===PolylineType.PolylineGlow&&n.setPolylineType(ActiveType),n.modifyPolylineGlowPower(parseInt(e)/100)}})}),this.enhancePrimitives(),enhanceWithListeners(this),this.restDefaultOptions()}Cesium.defineProperties(PlacePolylineViewModel.prototype,{scene:{get:function(){return this._scene}},onCreatedEvent:{get:function(){return this._onCreatedEvent}},onEditHandleMoveEvent:{get:function(){return this._onEditHandleMoveEvent}},selectedEntity:{get:function(){return this._selectedEntity},set:function(e){if(Cesium.defined(this._selectedEntity)&&Cesium.defined(this._selectedEntity.primitive)&&Cesium.defined(this._selectedEntity.primitive._markers)&&!this._selectedEntity.primitive._editMode&&this.cleanUp(),Cesium.defined(e)){if(this.cleanUp(),Cesium.defined(e.polyline)){var i;this._editType=PolylineEditType.EA_HANDLE_MOVE,this._editAction=PolylineEditorAction.EDIT,this._selectedEntity=e,this.polylineName=e.name,i=e.polyline.positions.getValue(),this.defaultPolylineOptions.classificationType=void 0;var t=Cesium.Material.fromType(Cesium.Material.ColorType);t.uniforms.color=new Cesium.Color(0,0,0,0),this._defaultMaterial=t,ActiveType=this.getPolylineType(e.polyline),this._ActiveType=ActiveType,Cesium.defined(i.positions)||(i={positions:i}),i=copyOptions(i,this.defaultPolylineOptions);var l=new PlacePolylinePrimitive(i);this._scene.primitives.add(l),l.setEditable(),l.setEditMode(!0),(this._selectedEntity.primitive=l)._selectedEntity=this._selectedEntity,(l._viewModel=this).width=e.polyline.width.getValue();var n=e.polyline.material.color.getValue(),o=new Cesium.Color(n.red,n.green,n.blue,1);if(this.polylineColor=o.toCssColorString(),polylineColorPicker.setColor(this.polylineColor),this.polylineAlpha=n.alpha,polylineColorSlider.setValue(100*this.polylineAlpha),e.polyline.material instanceof Cesium.PolylineGlowMaterialProperty)this.isGlowPowerPolyline="block",this.isOutlinePolyline="none",this.glowPower=e.polyline.material.glowPower,glowPowerSlider.setValue(100*this.glowPower);else if(e.polyline.material instanceof Cesium.PolylineOutlineMaterialProperty){this.isGlowPowerPolyline="none",this.isOutlinePolyline="block",this.outlineWidth=e.polyline.material.outlineWidth;n=e.polyline.material.outlineColor.getValue(),o=new Cesium.Color(n.red,n.green,n.blue,1);this.outlinePolylineColor=o.toCssColorString(),outlinePolylineColorPicker.setColor(this.outlinePolylineColor),this.outlinePolylineAlpha=n.alpha,outlinePolylineAlphaSlider.setValue(100*this.outlinePolylineAlpha)}else this.isGlowPowerPolyline="none",this.isOutlinePolyline="none"}}else this._selectedEntity=void 0}}}),PlacePolylineViewModel.prototype.cleanUp=function(){for(var e=this._scene.primitives,i=e._primitives.length-1;0<i;i--){var t=e._primitives[i];(t.isPolylineEditPrimitive||Cesium.defined(t._createPlacePolylinePrimitive))&&e.remove(t)}},PlacePolylineViewModel.prototype.restDefaultOptions=function(){this._defaultMaterial=Cesium.Material.fromType(Cesium.Material.ColorType),this._defaultMaterial.uniforms.color=Cesium.Color.YELLOW,this._defaultMaterialProperty=Cesium.Color.YELLOW,this.defaultPolylineOptions={ellipsoid:Cesium.Ellipsoid.WGS84,asynchronous:!1,show:!0,debugShowBoundingVolume:!1,classificationType:void 0,width:5,geodesic:!0,granularity:1e4,appearance:new Cesium.PolylineMaterialAppearance({material:this._defaultMaterial})},this._classificationType=void 0},PlacePolylineViewModel.prototype.setAction=function(e){this._editAction=e;var i=this;switch(e){case PolylineEditorAction.CREATE:this._startDrawingPolyline({callback:function(e){i.executeListeners({name:"polylineCreated",positions:e})}})}},PlacePolylineViewModel.prototype.setEditType=function(e){Cesium.defined(this.selectedEntity)&&(this._editType=e,this._editAction=PolylineEditorAction.EDIT)},PlacePolylineViewModel.prototype.setPolylineType=function(e){this.isGlowPowerPolyline="none",this.isOutlinePolyline="none",this._editType=PolylineEditType.NONE,this._ActiveType=e,ActiveType=e;var i=Cesium.Color.fromCssColorString(this.polylineColor);i=i.withAlpha(this.polylineAlpha);var t=Cesium.Color.fromCssColorString(this.outlinePolylineColor);switch(t=t.withAlpha(this.outlinePolylineAlpha),e){case PolylineType.PolylineColor:this._defaultMaterial=Cesium.Material.fromType("Color"),this._defaultMaterial.uniforms.color=i,this._defaultMaterialProperty=i;break;case PolylineType.PolylineOutline:this._defaultMaterial=Cesium.Material.fromType("PolylineOutline"),this._defaultMaterial.uniforms.color=i,this._defaultMaterial.uniforms.outlineWidth=this.outlineWidth,this._defaultMaterial.uniforms.outlineColor=t,this._defaultMaterialProperty=new Cesium.PolylineOutlineMaterialProperty({color:i,outlineWidth:this.outlineWidth,outlineColor:t}),this.isOutlinePolyline="block";break;case PolylineType.PolylineArrow:this._defaultMaterial=Cesium.Material.fromType("PolylineArrow"),this._defaultMaterial.uniforms.color=i,this._defaultMaterialProperty=new Cesium.PolylineArrowMaterialProperty(i);break;case PolylineType.PolylineDash:this._defaultMaterial=Cesium.Material.fromType("PolylineDash"),this._defaultMaterial.uniforms.color=i,this._defaultMaterialProperty=new Cesium.PolylineDashMaterialProperty({color:i});break;case PolylineType.PolylineGlow:this._defaultMaterial=Cesium.Material.fromType("PolylineGlow"),this._defaultMaterial.uniforms.color=i,this._defaultMaterial.uniforms.glowPower=this.glowPower,this._defaultMaterialProperty=new Cesium.PolylineGlowMaterialProperty({glowPower:this.glowPower,color:i}),this.isGlowPowerPolyline="block"}this.defaultPolylineOptions.material=this._defaultMaterial},PlacePolylineViewModel.prototype.getPolylineType=function(e){},PlacePolylineViewModel.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible},PlacePolylineViewModel.prototype.isDestroyed=function(){return!1},PlacePolylineViewModel.prototype.destroy=function(){this._eventHandler.destroy(),this._removePostRenderEvent();var i=this;return this._definedProperties.forEach(function(e){Cesium.knockout.getObservable(i,e).dispose()}),destroyObject(this)},PlacePolylineViewModel.prototype.initialiseHandlers=function(){var a=this._scene,d=this;Cesium.defined(this._eventHandler)&&(this._eventHandler.destroy(),this._eventHandler=void 0),this._eventHandler=new Cesium.ScreenSpaceEventHandler(a.canvas);var l,c,e=this._eventHandler;function y(e,i){if(1!=d._handlersMuted){var t=a.pick(i);t&&t.primitive&&t.primitive[e]&&t.primitive[e](i)}}e.setInputAction(function(e){y("leftClick",e.position)},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){y("leftDoubleClick",e.position)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);var p=1;e.setInputAction(function(e){if(d._editAction!=PolylineEditorAction.NONE&&1!=d._handlersMuted)if(Cesium.defined(c)&&d._editType==PolylineEditType.EA_POLYLINE_MOVE_Z){if(0==e.startPosition.y)return;var i=e.startPosition.y-e.endPosition.y;Cesium.defined(c._createPlacePolylinePrimitive)&&(c.offsetZ(i*p),c._markers.updateBillboardsPositions(c.positions),c._createPlacePolylinePrimitive=!0)}else{var t=a.pick(e.endPosition);!l||t&&l==t.primitive||((!l.isDestroyed||!l.isDestroyed())&&l.mouseOut(e.endPosition),l=null),t&&t.primitive&&((t=t.primitive).mouseOut&&(l=t),t.mouseMove&&t.mouseMove(e))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){c=null,y("leftUp",e.position),d._scene.screenSpaceCameraController.enableInputs=!0,Cesium.defined(d.selectedEntity)||(d._editType=PolylineEditType.NONE)},Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(e){c=null,y("leftDown",e.position);var i=a.pick(e.position);if(Cesium.defined(i)&&Cesium.defined(i.id)&&Cesium.defined(i.id.primitive)&&(c=i.id.primitive),d._editAction==PolylineEditorAction.EDIT&&(Cesium.defined(c)||Cesium.defined(i)&&Cesium.defined(i.primitive))){d._scene.screenSpaceCameraController.enableInputs=!1;var t=d._scene.pickGlobe(e.position);if(t){var l=new Cesium.BoundingRectangle;l.x=0,l.y=0,l.width=d._scene._context.drawingBufferWidth,l.height=d._scene._context.drawingBufferHeight;var n=Cesium.Cartographic.fromCartesian(t),o=Cesium.Cartographic.fromRadians(n.longitude,n.latitude,0),s=Cesium.DEUtility.project(t,d._scene.camera,l),r=Cesium.DEUtility.project(Cesium.Cartographic.toCartesian(o),d._scene.camera,l);p=n.height/(s.y-r.y)}}},Cesium.ScreenSpaceEventType.LEFT_DOWN)},PlacePolylineViewModel.prototype.setListener=function(e,i,t){e[i]=t},PlacePolylineViewModel.prototype.muteHandlers=function(e){this._handlersMuted=e},PlacePolylineViewModel.prototype.registerEditableShape=function(i){setListener(i,"mouseMove",function(e){i.setHighlighted(!0),i._editMode}),setListener(i,"mouseOut",function(e){i.setHighlighted(!1)}),setListener(i,"leftClick",function(e){i.setEditMode(!0)}),setListener(i,"leftUp",function(e){}),setListener(i,"leftDown",function(e){})},PlacePolylineViewModel.prototype.startDrawing=function(e){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=e,this.muteHandlers(!0)},PlacePolylineViewModel.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},PlacePolylineViewModel.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},PlacePolylineViewModel.prototype.setHighlighted=function(e){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=e&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=e},PlacePolylineViewModel.prototype.disableAllEditMode=function(){this.setEdited(void 0)},PlacePolylineViewModel.prototype.setEdited=function(e){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=e};var PolylineHandle=function(e,i){this._viewModel=e,this._scene=e._scene;var t={iconUrl:"".concat(e._viewer._basePath,"/Plugins/assets/dragIcon.png"),shiftX:0,shiftY:0};this._options=copyOptions(i,t);var l=new Cesium.BillboardCollection;l.isPolylineEditPrimitive=!0,this._scene.primitives.add(l),this._billboards=l,this._orderedBillboards=[]};function clone(e,i){if(null==e||"object"!=_typeof(e))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var t in i=i||new e.constructor,e)i[t]=void 0===i[t]?clone(e[t],null):i[t];return i}function fillOptions(e,i){var t;for(t in e=e||{},i)void 0===e[t]&&(e[t]=clone(i[t]))}function copyOptions(e,i){var t,l=clone(e);for(t in i)void 0===l[t]&&(l[t]=clone(i[t]));return l}function setListener(e,i,t){e[i]=t}function enhanceWithListeners(e){e._listeners={},e.addListener=function(e,i){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(i),this._listeners[e].length},e.executeListeners=function(e,i){if(this._listeners[e.name]&&0<this._listeners[e.name].length)for(var t=0;t<this._listeners[e.name].length;t++)this._listeners[e.name][t](e);else i&&i(e)}}function viewerPlacePolylineMixin(e){var i=new PlacePolyline(document.querySelector(".cesium-viewer"),e);Cesium.defineProperties(e,{placePolyline:{get:function(){return i}}})}PolylineHandle.prototype.createBillboard=function(e,c){var y=this._billboards.add({show:!0,position:e,pixelOffset:new Cesium.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,scale:1.2,image:this._options.iconUrl,color:new Cesium.Color(1,1,1,1)});if(this._viewModel._editAction==PolylineEditorAction.EDIT&&(y.disableDepthTestDistance=1e4,Cesium.defined(this._viewModel.defaultPolylineOptions.classificationType)?this._billboards._depthMask=!1:this._billboards._depthMask=!0),c){var p=function(e){i.enableRotate=e},u=function(){for(var e=0,i=h._orderedBillboards.length;e<i&&h._orderedBillboards[e]!=y;++e);return e},h=this,i=this._scene.screenSpaceCameraController;if(c.dragHandlers){h=this;var f=Cesium.Ellipsoid.WGS84,P=1;setListener(y,"leftDown",function(e){function n(e){i.destroy(),p(!0),c.dragHandlers.onDragEnd&&c.dragHandlers.onDragEnd(u(),e)}var i=new Cesium.ScreenSpaceEventHandler(h._scene.canvas);switch(i.setInputAction(function(e){var i=void 0;switch(h._viewModel._editType){case PolylineEditType.EA_HANDLE_MOVE:i=Cesium.defined(h._viewModel.defaultPolylineOptions.classificationType)?h._scene.pickGlobe(e.endPosition):h._scene.camera.pickEllipsoid(e.endPosition,f);break;case PolylineEditType.EA_HANDLE_MOVE_Z:if(0==e.startPosition.y)return;var t=e.startPosition.y-e.endPosition.y,l=Cesium.Cartographic.fromCartesian(y.position);l.height+=t*P,i=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,l.height)}i?function(e){y.position=e;for(var i=0,t=h._orderedBillboards.length;i<t&&h._orderedBillboards[i]!=y;++i);c.dragHandlers.onDrag&&c.dragHandlers.onDrag(u(),e)}(i):n(i)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(function(e){n(h._scene.pickGlobe(e.position))},Cesium.ScreenSpaceEventType.LEFT_UP),p(!1),h._viewModel._editType){case PolylineEditType.EA_HANDLE_MOVE:if(l=y.position){var t=Cesium.Cartesian3.magnitude(l);f=new Cesium.Ellipsoid(t,t,t)}break;case PolylineEditType.EA_HANDLE_MOVE_Z:var l;if(l=y.position){var o=new Cesium.BoundingRectangle;o.x=0,o.y=0,o.width=h._viewModel._scene._context.drawingBufferWidth,o.height=h._viewModel._scene._context.drawingBufferHeight;var s=Cesium.Cartographic.fromCartesian(l),r=Cesium.Cartographic.fromRadians(s.longitude,s.latitude,0),a=Cesium.DEUtility.project(l,h._viewModel._scene.camera,o),d=Cesium.DEUtility.project(Cesium.Cartographic.toCartesian(r),h._viewModel._scene.camera,o);P=s.height/(a.y-d.y)}}})}c.onDoubleClick&&setListener(y,"leftDoubleClick",function(e){c.onDoubleClick(u())}),c.onClick&&setListener(y,"leftClick",function(e){c.onClick(u())}),c.tooltip&&(setListener(y,"mouseMove",function(e){}),setListener(y,"mouseOut",function(e){}))}return y},PolylineHandle.prototype.insertBillboard=function(e,i,t){this._orderedBillboards.splice(e,0,this.createBillboard(i,t))},PolylineHandle.prototype.addBillboard=function(e,i){this._orderedBillboards.push(this.createBillboard(e,i))},PolylineHandle.prototype.addBillboards=function(e,i){for(var t=0;t<e.length;t++)this.addBillboard(e[t],i)},PolylineHandle.prototype.updateBillboardsPositions=function(e){for(var i=0;i<e.length;i++)this.getBillboard(i).position=e[i]},PolylineHandle.prototype.countBillboards=function(){return this._orderedBillboards.length},PolylineHandle.prototype.getBillboard=function(e){return this._orderedBillboards[e]},PolylineHandle.prototype.removeBillboard=function(e){this._billboards.remove(this.getBillboard(e)),this._orderedBillboards.splice(e,1)},PolylineHandle.prototype.remove=function(){this._scene.primitives.remove(this._billboards)},PolylineHandle.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},PlacePolylineViewModel.prototype.drawingPolyline=function(){this.setAction(PolylineEditorAction.CREATE),this.setPolylineType(PolylineType.PolylineColor)},PlacePolylineViewModel.prototype.drawingPolylineOutline=function(){this.setAction(PolylineEditorAction.CREATE),this.setPolylineType(PolylineType.PolylineOutline)},PlacePolylineViewModel.prototype.drawingPolylineArrow=function(){this.setAction(PolylineEditorAction.CREATE),this.setPolylineType(PolylineType.PolylineArrow)},PlacePolylineViewModel.prototype.drawingPolylineDash=function(){this.setAction(PolylineEditorAction.CREATE),this.setPolylineType(PolylineType.PolylineDash)},PlacePolylineViewModel.prototype.drawingPolylineGlow=function(){this.setAction(PolylineEditorAction.CREATE),this.setPolylineType(PolylineType.PolylineGlow)},PlacePolylineViewModel.prototype._startDrawingPolyline=function(e){e=copyOptions(e,this.defaultPolylineOptions);this.startDrawingPolyshape(e)},PlacePolylineViewModel.prototype.startDrawingPolyshape=function(e){this.startDrawing(function(){i.remove(r),d.remove(),l.destroy()});var o=this,s=this._scene,i=s.primitives,r=new PlacePolylinePrimitive(e);r._viewModel=this,i.add(r);var t={iconUrl:"".concat(o._viewer._basePath,"/Plugins/assets/dragIcon.png"),shiftX:0,shiftY:0},a=[],d=new PolylineHandle(this,t),l=new Cesium.ScreenSpaceEventHandler(s.canvas),c=!1;l.setInputAction(function(e){if(null!=e.position){var i=s.pickGlobe(e.position);if(i){if(0==a.length&&(a.push(i.clone()),d.addBillboard(a[0])),2<=a.length){for(var t=[],l=0;l<a.length;l++)t.push(a[l].clone());r.positions=t,r._createPlacePolylinePrimitive=!0}a.push(i.clone()),d.addBillboard(i.clone()),c=!0,o._scene.screenSpaceCameraController.enableInputs=o.cameraController}}},Cesium.ScreenSpaceEventType.LEFT_DOWN),l.setInputAction(function(e){c=!1,o._scene.screenSpaceCameraController.enableInputs=!0},Cesium.ScreenSpaceEventType.LEFT_UP),l.setInputAction(function(e){var i=e.endPosition;if(null!=i)if(0==a.length);else{var t=s.pickGlobe(i);if(t)if(c&&!o.cameraController){if(0==a.length&&(a.push(t.clone()),d.addBillboard(a[0])),2<=a.length){for(var l=[],n=0;n<a.length;n++)l.push(a[n].clone());r.positions=l,r._createPlacePolylinePrimitive=!0}a.push(t.clone()),d.addBillboard(t.clone())}else{if(a.pop(),a.push(t.clone()),2<=a.length){for(l=[],n=0;n<a.length;n++)l.push(a[n].clone());r.positions=l,r._createPlacePolylinePrimitive=!0}d.getBillboard(a.length-1).position=t.clone()}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(e){var i=e.position;if(null!=i){if(a.length<4)return;s.pickGlobe(i)&&(o.stopDrawing(),a.splice(a.length-2,2),o.createPolylineEntity(a),o.setEditType(PolylineEditType.EA_HANDLE_MOVE))}},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),l.setInputAction(function(e){o.stopDrawing(),a.splice(a.length-1,1),o.createPolylineEntity(a),o.setEditType(PolylineEditType.EA_HANDLE_MOVE)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)},PlacePolylineViewModel.prototype.enhancePrimitives=function(){var r=this;function t(e){if(this._editMode!=e)if(r.disableAllHighlights(),e){r.setEdited(this);var t=r._scene,l=this;if(null==this._markers){var n=function(){l.executeListeners({name:"onEdited",positions:l.positions})},i={iconUrl:"".concat(r._viewer._basePath,"/Plugins/assets/dragIcon.png"),shiftX:0,shiftY:0},o=new PolylineHandle(r,i),s={dragHandlers:{onDrag:function(e,i){l.positions[e]=i,l._createPlacePolylinePrimitive=!0},onDragEnd:function(e,i){l._createPlacePolylinePrimitive=!0,n()}},onDoubleClick:function(e){l.positions.length<4||r._editType==PolylineEditType.EA_GEOMETRY_EXTRUDED||(l.positions.splice(e,1),l._createPlacePolylinePrimitive=!0,o.removeBillboard(e),n())}};o.addBillboards(l.positions,s),this._markers=o,this._globeClickhandler=new Cesium.ScreenSpaceEventHandler(t.canvas),this._globeClickhandler.setInputAction(function(e){var i=t.pick(e.position);i&&i.primitive||(l.setEditMode(!1),t.primitives.remove(l))},Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1}Cesium.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var l=this,n=this;setListener(l,"leftDown",function(e){function t(e){i.destroy(),o(!0),n.executeListeners({name:"dragEnd",positions:e})}var i=new Cesium.ScreenSpaceEventHandler(l._scene.canvas);i.setInputAction(function(e){var i=r._scene.pickGlobe(e.endPosition);i?function(e){l.position=e,n.executeListeners({name:"drag",positions:e})}(i):t(i)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(function(e){t(r._scene.camera.pickGlobe(e.position))},Cesium.ScreenSpaceEventType.LEFT_UP),o(!1)}),enhanceWithListeners(l)}function o(e){r._scene.screenSpaceCameraController.enableRotate=e}},PlacePolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){var e=this;e.isPolygon=!1,e.asynchronous=!1,r.registerEditableShape(e),e.setEditMode=t;var i=this.width;e.setHighlighted=function(e){!0!==this._editMode&&(e?(r.setHighlighted(this),this.setWidth(2*i)):this.setWidth(i))},e.getExtent=function(){return Cesium.Extent.fromCartographicArray(ellipsoid.cartesianArrayToCartographicArray(this.positions))},enhanceWithListeners(e),e.setEditMode(!1)}}},PlacePolylineViewModel.prototype.createPolylineEntity=function(e){if(!(e.length<2)){var i=this._viewer.entities.add({name:this.polylineName,polyline:{positions:e,width:this.width,material:this._defaultMaterialProperty}});this.selectedEntity=i,ActiveType=void 0,this._ActiveType=void 0,"undefined"!=typeof ACTION&&this.onCreatedEvent.raiseEvent({action:ACTION.CREATE,type:CONSTANT.DE_Polyline,value:i})}},PlacePolylineViewModel.prototype.modifyPolylineName=function(){Cesium.defined(this.selectedEntity)&&(this.selectedEntity.name=this.polylineName,"undefined"!=typeof ACTION&&this.onCreatedEvent.raiseEvent({action:ACTION.UPDATA,type:CONSTANT.DE_Polyline,value:this.selectedEntity}))},PlacePolylineViewModel.prototype.modifyPolylineWidth=function(){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&(this.selectedEntity.polyline.width=Number(this.width))},PlacePolylineViewModel.prototype.modifyPolylineColor=function(e){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&(this.selectedEntity.polyline.material.color=Cesium.Color.fromCssColorString(e))},PlacePolylineViewModel.prototype.modifyPolylineAlpha=function(e){if(Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)){var i=this.selectedEntity.polyline.material.color.getValue();this.selectedEntity.polyline.material.color=i.withAlpha(e)}},PlacePolylineViewModel.prototype.modifyPolylineOutlineColor=function(e){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&Cesium.defined(this.selectedEntity.polyline.material)&&Cesium.defined(this.selectedEntity.polyline.material instanceof Cesium.PolylineOutlineMaterialProperty)&&(this.selectedEntity.polyline.material.outlineColor=Cesium.Color.fromCssColorString(e))},PlacePolylineViewModel.prototype.modifyPolylineOutlineAlpha=function(e){if(Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&Cesium.defined(this.selectedEntity.polyline.material)&&Cesium.defined(this.selectedEntity.polyline.material instanceof Cesium.PolylineOutlineMaterialProperty)){var i=this.selectedEntity.polyline.material.outlineColor.getValue();this.selectedEntity.polyline.material.outlineColor=i.withAlpha(e)}},PlacePolylineViewModel.prototype.modifyPolylineOutlineWidth=function(){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&Cesium.defined(this.selectedEntity.polyline.material)&&Cesium.defined(this.selectedEntity.polyline.material instanceof Cesium.PolylineOutlineMaterialProperty)&&(this.selectedEntity.polyline.material.outlineWidth=Number(this.outlineWidth))},PlacePolylineViewModel.prototype.modifyPolylineGlowPower=function(e){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.polyline)&&Cesium.defined(this.selectedEntity.polyline.material)&&Cesium.defined(this.selectedEntity.polyline.material instanceof Cesium.PolylineGlowMaterialProperty)&&(this.selectedEntity.polyline.material.glowPower=e)},PlacePolylineViewModel.prototype.Edit=function(e){var t=this;t.selectedEntity=e,layui.use("layer",function(){var e=layui.layer;t._layerIndex=e.open({type:1,skin:"dataEarth-viewer-polylineLayer",area:"262px",shade:0,anim:0,title:" ",resize:!1,offset:["80px","360px"],content:$(t._element),success:function(){t._viewer.layersManager&&(t._viewer.layersManager.viewModel._layersManagerOverLay="block"),t.initialiseHandlers(),t._removeselectedEntityChanged=t._viewer.selectedEntityChanged.addEventListener(function(e){t.selectedEntity=e})},cancel:function(e,i){t._viewer.layersManager&&(t._viewer.layersManager.viewModel._layersManagerOverLay="none"),t.hidden()}})})},PlacePolylineViewModel.prototype.Show=function(){var t=this;layui.use("layer",function(){var e=layui.layer;t._layerIndex=e.open({type:1,skin:"dataEarth-viewer-polylineLayer",area:"262px",shade:0,anim:0,title:" ",resize:!1,offset:["80px","360px"],content:$(t._element),success:function(){t._viewer.layersManager&&(t._viewer.layersManager.viewModel._layersManagerOverLay="block"),t.initialiseHandlers(),t._removeselectedEntityChanged=t._viewer.selectedEntityChanged.addEventListener(function(e){t.selectedEntity=e}),t.drawingPolyline()},cancel:function(e,i){t._viewer.layersManager&&(t._viewer.layersManager.viewModel._layersManagerOverLay="none"),t.hidden()}})})},PlacePolylineViewModel.prototype.hidden=function(){Cesium.defined(this._eventHandler)&&0<this._layerIndex&&(layui.layer.close(this._layerIndex),this._eventHandler.destroy(),this.cleanUp(),this.selectedEntity=null,Cesium.defined(this._removeselectedEntityChanged)&&this._removeselectedEntityChanged())},PlacePolylineViewModel.prototype.cameraControllerChange=function(){this.cameraController=!this.cameraController};