"use strict";function PlacePoint(e,t){var i=document.createElement("div");this._element=i,(this._container=e).appendChild(i),i.classList.add("dataEarth-pointLayer"),i.style.display="none";var n=document.createElement("div");n.className="dataEarth-selection-wrapper",n.setAttribute("data-bind",'style: { "top" : _screenPositionY, "left" : _screenPositionX },css: { "dataEarth-selection-wrapper-visible" : isVisible }'),e.appendChild(n);var a="http://www.w3.org/2000/svg",s=document.createElementNS(a,"svg");s.setAttribute("width",160),s.setAttribute("height",160),s.setAttribute("viewBox","0 0 160 160");var o=document.createElementNS(a,"g");o.setAttribute("transform","translate(80,80)"),s.appendChild(o);var l=document.createElementNS(a,"path");l.setAttribute("data-bind","attr: { transform: _transform }"),l.setAttribute("d","M -34 -34 L -34 -11.25 L -30 -15.25 L -30 -30 L -15.25 -30 L -11.25 -34 L -34 -34 z M 11.25 -34 L 15.25 -30 L 30 -30 L 30 -15.25 L 34 -11.25 L 34 -34 L 11.25 -34 z M -34 11.25 L -34 34 L -11.25 34 L -15.25 30 L -30 30 L -30 15.25 L -34 11.25 z M 34 11.25 L 30 15.25 L 30 30 L 15.25 30 L 11.25 34 L 34 34 L 34 11.25 z"),o.appendChild(l),n.appendChild(s);i.innerHTML='\n  <div>\n   <div class="tabSelect">\n    <a class="active">基本信息</a>\n    <a >属性信息</a>\n   </div>\n   <div id="basicInfo"></div>\n   <div id="attrInfoWrap">\n    <textarea typee="text" id="attrInfo" placeholder="可添加：文本/html/网址(以http,https开头)" data-bind="value: attrInfo, event: {input: modifyAttrInfo}, valueUpdate: \'input\'"/>\n   </div>\n   \n  </div>\n  ';var r='<dl>      <dt>名称</dt>      <dd><input type="text" class="elementName" data-bind="value: pointName, event: {input: modifyPointName}, valueUpdate: \'input\'"></dd>    </dl>    <dl>      <dt>位置</dt>      <dd>        <div class="elementSite">经度 <input type="text" data-bind="value: pointLongitude, event: {input: modifyGps}, valueUpdate: \'input\'"></div>        <div class="elementSite">纬度 <input type="text" data-bind="value: pointLatitude, event: {input: modifyGps}, valueUpdate: \'input\'"></div>        <div class=\'elementHeight\'>高度            <select data-bind="options:heightOptions, optionsText: \'text\', optionsValue: \'value\', value:heightReference">                <option value="0">绝对高度</option>                <option value="2">相对高度</option>                <option value="1">依地高度</option>              </select>              <input type="text" data-bind="value: pointHeight, event: {input: modifyGps}, valueUpdate: \'input\', enable: heightReference !== Cesium.HeightReference.CLAMP_TO_GROUND"> </div>        </div>      </dd>    </dl>    <dl>      <dt>图标</dt>      <dd class=\'elementIcon\'><a data-bind="click: modifyPointImage.bind($data, \''+t._basePath+"/Plugins/assets/dingwei.png'), css: { current: (pointImage._value || pointImage)  === '"+t._basePath+"/Plugins/assets/dingwei.png'}\">   <img src='"+t._basePath+"/Plugins/assets/dingwei.png'/></a><a data-bind=\"click: modifyPointImage.bind($data, '"+t._basePath+"/Plugins/assets/dingwei2.png'), css: { current: (pointImage._value || pointImage) === '"+t._basePath+"/Plugins/assets/dingwei2.png'}\">   <img src='"+t._basePath+"/Plugins/assets/dingwei2.png'/></a><a data-bind=\"click: modifyPointImage.bind($data, '"+t._basePath+"/Plugins/assets/dingwei3.png'), css: { current: (pointImage._value || pointImage) === '"+t._basePath+"/Plugins/assets/dingwei3.png'}\">   <img src='"+t._basePath+"/Plugins/assets/dingwei3.png'/></a><a data-bind=\"click: modifyPointImage.bind($data, '"+t._basePath+"/Plugins/assets/dingwei4.png'), css: { current: (pointImage._value || pointImage) === '"+t._basePath+"/Plugins/assets/dingwei4.png'}\">   <img src='"+t._basePath+"/Plugins/assets/dingwei4.png'/></a><a data-bind=\"click: modifyPointImage.bind($data, '"+t._basePath+"/Plugins/assets/dingwei5.png'), css: { current: (pointImage._value || pointImage) === '"+t._basePath+"/Plugins/assets/dingwei5.png'}\">   <img src='"+t._basePath+"/Plugins/assets/dingwei5.png'/></a><a data-bind=\"click: modifyPointImage.bind($data, '"+t._basePath+"/Plugins/assets/dingwei6.png'), css: { current: (pointImage._value || pointImage) === '"+t._basePath+"/Plugins/assets/dingwei6.png'}\">   <img src='"+t._basePath+'/Plugins/assets/dingwei6.png\'/></a>        <span data-bind=\'click: showPointIconList\'></span>      </dd>    </dl>    <dl>      <dt>图标样式</dt>      <dd>        <div class=\'pickerWrap\'>          颜色 <span class="colorPicker"><span id="pointImageColor"></span><label for="" data-bind="text: pointImageColor">#fff</label></span>          大小 <input type="number" data-bind="value: pointImageSize, event: {input: modifyPointImageSize}, valueUpdate: \'input\'" >        </div>        <div class=\'sliderWrap\'>          不透明度 <span id="pointImageColorAlpha" class="sliderAlpha"></span>        </div>      </dd>    </dl>    <dl>        <dt>标签样式</dt>        <dd>          <div class=\'pickerWrap\'>            颜色 <span class="colorPicker"><span id="pointLabelColor"></span><label for="" data-bind="text: pointLabelColor">#fff</label></span>            大小 <input type="number" data-bind="value: pointLabelSize, event: {input: modifyPointLabelSize}, valueUpdate: \'input\'">          </div>          <div class=\'sliderWrap\'>            不透明度 <span id="pointLabelColorAlpha" class="sliderAlpha"></span>          </div>        </dd>      </dl>',d=document.querySelector("#basicInfo");d.innerHTML=r;var c=new PlacePointViewModel(t,n,i);this._viewModel=c,Cesium.knockout.applyBindings(this._viewModel,i),Cesium.knockout.applyBindings(this._viewModel,n);var p=document.querySelectorAll(".tabSelect a");p.forEach(function(e){e.addEventListener("click",function(e){p.forEach(function(e){e.classList.remove("active")}),e.target.classList.add("active"),"基本信息"===e.target.innerText?(attrInfoWrap.style.display="none",d.style.display="block"):(d.style.display="none",attrInfoWrap.style.display="block")},!1)})}Cesium.defineProperties(PlacePoint.prototype,{viewModel:{get:function(){return this._viewModel}}});var pointListLayer,pointImageColorPicker,pointImageColorAlphaSlider,pointLabelColorPicker,pointLabelColorAlphaSlider,EditMarkerType={EMT_HANDLE_MOVE_XY:0,EMT_HANDLE_MOVE_Z:1,NONE:2,EMT_HANDLE_SELECTED:3},screenSpacePos=new Cesium.Cartesian2,offScreen="-1000px";function PlacePointViewModel(n,e,t){if(!Cesium.defined(n))throw new Cesium.DeveloperError("viewer is required.");if(!Cesium.defined(e))throw new Cesium.DeveloperError("selectionIndicatorElement is required.");var a=this;this._viewer=n,this._scene=n.scene,this._element=t,this._onCreatedEvent=new Cesium.Event,this._screenPositionX=offScreen,this._screenPositionY=offScreen,this._tweens=n.scene.tweens,this._container=n.container,this._selectionIndicatorElement=e,this._eventHandler=void 0,this._scale=1,this._drawing=!1,this._EditType=EditMarkerType.NONE,this._EditTypeTemp=EditMarkerType.NONE,this._selectedEntity=void 0,this._ellipsoid=Cesium.Ellipsoid.WGS84,this._isSelected=EditMarkerType.NONE,this.position=void 0,this.showSelection=!0,Cesium.knockout.track(this,["position","_screenPositionX","_screenPositionY","_scale","showSelection","pointName","heightReference","pointLongitude","pointLatitude","pointHeight","pointImage","pointImageColor","pointImageSize","pointImageColorAlpha","pointLabelColor","pointLabelSize","pointLabelColorAlpha","attrInfo"]),this.heightOptions=[{text:"绝对高度",value:Cesium.HeightReference.NONE},{text:"相对高度",value:Cesium.HeightReference.RELATIVE_TO_GROUND},{text:"依地高度",value:Cesium.HeightReference.CLAMP_TO_GROUND}],this.heightReference=Cesium.HeightReference.NONE,this.pointName="未命名标注",this.attrInfo="",this.pointLongitude="0.000",this.pointLatitude="0.000",this.pointHeight=0,this.pointImage="".concat(n._basePath,"/Plugins/assets/dingwei.png"),this.pointImageColor="#fff",this.pointImageSize=32,this.pointImageColorAlpha=1,this.pointLabelColor="#fff",this.pointLabelSize=16,this.pointLabelColorAlpha=1,this.isVisible=void 0,Cesium.knockout.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&Cesium.defined(this.position)}}),Cesium.knockout.defineProperty(this,"_transform",{get:function(){return"scale("+this._scale+")"}}),this.computeScreenSpacePosition=function(e,t){return Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.scene,e,t)};var i=document.createElement("div");i.classList.add("placePoint-info");var s=document.createElement("div");s.classList.add("placePoint-tit"),i.appendChild(s);s.innerHTML='\n  <a class="tit-zoom zoom-out"></a>\n  <a class="tit-close"></a>\n  ';var o=document.createElement("div");o.classList.add("pointContent"),i.appendChild(o);var l=new Cesium.DEHtmlOverlay(a._viewer.scene,i.cloneNode(!0));l.pixelOffset=new Cesium.Cartesian2(-10,40),l.show=!1,l.depthTest=!1,document.querySelector(".tit-zoom").addEventListener("click",function(){this.classList.remove("zoom-out"),this.classList.add("zoom-in"),l.show=!1;var e=document.createElement("div");e.classList.add("placePoint-fullPage"),document.body.appendChild(e),e.innerHTML=document.querySelector(".placePoint-info").innerHTML,document.querySelectorAll(".tit-zoom")[1].addEventListener("click",function(){document.body.removeChild(document.querySelector(".placePoint-fullPage"));var e=document.querySelector(".tit-zoom");e.classList.remove("zoom-in"),e.classList.add("zoom-out"),l.show=!0}),document.querySelectorAll(".tit-close")[1].addEventListener("click",function(){document.body.removeChild(document.querySelector(".placePoint-fullPage"));var e=document.querySelector(".tit-zoom");e.classList.remove("zoom-in"),e.classList.add("zoom-out"),l.show=!1})}),document.querySelector(".tit-close").addEventListener("click",function(){l.show=!1}),n.selectedEntityChanged.addEventListener(function(e){if(e instanceof Cesium.Entity&&(!a._layerIndex||0===a._layerIndex)&&e.info){var t=document.querySelector(".tit-zoom");t.style.display="inline-block";var i=l.element.querySelector(".pointContent");if(i.innerHTML="",0===e.info.indexOf("http")){var n=document.createElement("iframe");i.appendChild(n),n.src=e.info,n.width="100%",n.height="100%",n.setAttribute("frameborder",0)}else if(e.info.includes("<html>")&&e.info.includes("</html>")){(n=document.createElement("iframe")).width="100%",n.height="100%",n.setAttribute("frameborder",0),i.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.write(e.info),n.contentWindow.document.close()}else t.style.display="none",i.innerText=e.info;l.position=e.position._value,1===e.billboard.verticalOrigin._value?l.pixelOffset=new Cesium.Cartesian2(-10,40):l.pixelOffset=new Cesium.Cartesian2(-10,20),l.show=!0}}),$(document).ready(function(){var e={preview:!0,opacity:!1,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!0}};pointImageColorPicker=Pickr.create({el:"#pointImageColor",default:a.pointImageColor,components:e,strings:{save:"保存"},onSave:function(e,t){a.pointImageColor=e.toHEX().toString(),a.modifyPointImageColor()}}),pointLabelColorPicker=Pickr.create({el:"#pointLabelColor",default:a.pointLabelColor,components:e,strings:{save:"保存"},onSave:function(e,t){a.pointLabelColor=e.toHEX().toString(),a.modifyPointLabelColor()}}),layui.use("slider",function(){var e=layui.slider;pointImageColorAlphaSlider=e.render({elem:"#pointImageColorAlpha",value:100,setTips:function(e){return e+"%"},change:function(e){a.pointImageColorAlpha=parseInt(e)/100,a.modifyPointImageColor()}})}),layui.use("slider",function(){var e=layui.slider;pointLabelColorAlphaSlider=e.render({elem:"#pointLabelColorAlpha",value:100,setTips:function(e){return e+"%"},change:function(e){a.pointLabelColorAlpha=parseInt(e)/100,a.modifyPointLabelColor()}})})}),this.showPointIconList=function(){var i=this;pointListLayer||layui.use("layer",function(){var e=layui.layer;pointListLayer=e.open({type:1,skin:"dataEarth-viewer-pointList",area:"330px",shade:0,anim:0,title:" ",resize:!1,move:!1,offset:["370px","630px"],content:"",success:function(){var e=$(".dataEarth-viewer-pointList .layui-layer-content"),t='\n            <a class="pointIcon-list" data-point-url="'.concat(n._basePath,'/Plugins/assets/building3.png"><img src="').concat(n._basePath,'/Plugins/assets/building3.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/fangzi2.png"><img src="').concat(n._basePath,'/Plugins/assets/fangzi2.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/feiji1.png"><img src="').concat(n._basePath,'/Plugins/assets/feiji1.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/feiji2.png"><img src="').concat(n._basePath,'/Plugins/assets/feiji2.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/feiji3.png"><img src="').concat(n._basePath,'/Plugins/assets/feiji3.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/jianzhu1.png"><img src="').concat(n._basePath,'/Plugins/assets/jianzhu1.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/qiche1.png"><img src="').concat(n._basePath,'/Plugins/assets/qiche1.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/qiche2.png"><img src="').concat(n._basePath,'/Plugins/assets/qiche2.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/qiche3.png"><img src="').concat(n._basePath,'/Plugins/assets/qiche3.png"/></a>\n            <a class="pointIcon-list" data-point-url="').concat(n._basePath,'/Plugins/assets/qiche4.png"><img src="').concat(n._basePath,'/Plugins/assets/qiche4.png"/></a>\n            ');e.append($(t)),$(".pointIcon-list").on("click",function(){i.pointImage=$(this).attr("data-point-url"),i.modifyPointImage(i.pointImage),$(this).siblings().removeClass("current"),$(this).addClass("current")})},cancel:function(){pointListLayer=void 0}})})}}function calcDifference(e,t,i){var n=e._ellipsoid.cartesianToCartographic(t),a=Cesium.Math.toDegrees(n.longitude),s=Cesium.Math.toDegrees(n.latitude),o=e._ellipsoid.cartesianToCartographic(i),l=Cesium.Math.toDegrees(o.longitude)-a,r=Cesium.Math.toDegrees(o.latitude)-s,d=Cesium.Cartographic.fromCartesian(e._selectedEntity.position.getValue()),c=Cesium.Math.toDegrees(d.longitude)+l,p=Cesium.Math.toDegrees(d.latitude)+r,u=[];return u.push(c),u.push(p),u}function viewerPlacePointMixin(e){var t=new PlacePoint(document.querySelector(".cesium-viewer"),e);Cesium.defineProperties(e,{placePoint:{get:function(){return t}}})}Cesium.defineProperties(PlacePointViewModel.prototype,{onCreatedEvent:{get:function(){return this._onCreatedEvent}},selectedEntity:{get:function(){return this._selectedEntity},set:function(e){if(Cesium.defined(this._selectedEntity)&&Cesium.defined(this._selectedEntity.primitive)&&Cesium.defined(this._selectedEntity.primitive._markers)&&!this._selectedEntity.primitive._editMode&&this.cleanUp(),Cesium.defined(e))if(this.cleanUp(),Cesium.defined(e.billboard)){this._EditType=EditMarkerType.EMT_HANDLE_MOVE_XY,this._isSelected=EditMarkerType.EMT_HANDLE_SELECTED,this._selectedEntity=e,this.position=e.position.getValue(),this.update();var t=Cesium.Cartographic.fromCartesian(e.position.getValue()),i=Cesium.Math.toDegrees(t.longitude).toFixed(6),n=Cesium.Math.toDegrees(t.latitude).toFixed(6);this.pointName=e.label.text,this.attrInfo=e.info,this.pointLongitude=i,this.pointLatitude=n,this.pointHeight=0<t.height?t.height.toFixed(2):0,this.heightReference=e.billboard.heightReference,this.pointImage=e.billboard.image}else this._selectedEntity=void 0;else this._selectedEntity=void 0}}}),PlacePointViewModel.prototype.cleanUp=function(){for(var e=this._scene.primitives,t=e._primitives.length-1;0<t;t--){var i=e._primitives[t];i.isEditPrimitive&&e.remove(i)}},PlacePointViewModel.prototype.update=function(){if(this.showSelection&&Cesium.defined(this.position)){var e=this.computeScreenSpacePosition(this.position,screenSpacePos);if(Cesium.defined(e)){var t=this._container,i=t.parentNode.clientWidth,n=t.parentNode.clientHeight,a=this._selectionIndicatorElement.clientWidth,s=.5*a;e.x=Math.min(Math.max(e.x,-a),i+a)-s,e.y=Math.min(Math.max(e.y,-a),n+a)-s,this._screenPositionX=Math.floor(e.x+.25)+"px",this._screenPositionY=Math.floor(e.y+.25)+"px"}else this._screenPositionX=offScreen,this._screenPositionY=offScreen}},PlacePointViewModel.prototype.animateAppear=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:2,stopValue:1,duration:.8,easingFunction:EasingFunction.EXPONENTIAL_OUT})},PlacePointViewModel.prototype.animateDepart=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:this._scale,stopValue:1.5,duration:.8,easingFunction:Cesium.EasingFunction.EXPONENTIAL_OUT})},PlacePointViewModel.prototype.initialiseHandlers=function(){var y=this;this._eventHandler=new Cesium.ScreenSpaceEventHandler(y._viewer.scene.canvas);var e=this._eventHandler;e.setInputAction(function(e){if(y._drawing&&!Cesium.defined(y.selectedEntity)){var t=y._viewer.scene.pickGlobe(e.position);if(null==t)return;var i=Cesium.Cartographic.fromCartesian(t),n=Cesium.Math.toDegrees(i.longitude),a=Cesium.Math.toDegrees(i.latitude),s=0<i.height?i.height:0;y.pointHeight=s;var o=new Cesium.Cartesian3.fromDegrees(n,a,s),l=y.pointImage._value?y.pointImage._value:y.pointImage;y.selectedEntity=y._viewer.entities.add({name:"未命名标注",position:o,label:{text:"未命名标注",font:y.pointLabelSize+"px Microsoft YaHei",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.fromCssColorString(y.pointLabelColor).withAlpha(y.pointLabelColorAlpha),outlineWidth:3,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:l.includes("dingwei")?Cesium.VerticalOrigin.BOTTOM:Cesium.VerticalOrigin.CENTER,pixelOffset:new Cesium.Cartesian2(15,-2),disableDepthTestDistance:1e9},billboard:{image:y.pointImage,width:y.pointImageSize,height:y.pointImageSize,color:Cesium.Color.fromCssColorString(y.pointImageColor).withAlpha(y.pointImageColorAlpha),disableDepthTestDistance:1e9,heightReference:y.heightReference,verticalOrigin:l.includes("dingwei")?Cesium.VerticalOrigin.BOTTOM:Cesium.VerticalOrigin.CENTER},attrInfo:""}),"undefined"!=typeof ACTION&&y.onCreatedEvent.raiseEvent({action:ACTION.CREATE,type:CONSTANT.DE_Point,value:y._selectedEntity}),y.position=y._selectedEntity.position._value,y.update(),y.LaterallyTranslate(EditMarkerType.EMT_HANDLE_MOVE_XY)}else{var r=y._viewer.scene.pick(e.position);Cesium.defined(r)?Cesium.defined(r.id)&&"EditMarker"==r.id.name&&(y._selectedEntity=r,y.position=y._selectedEntity.id.position._value,y.update(),y._isSelected=EditMarkerType.EMT_HANDLE_SELECTED):(y.pointImage="",$(".pointIcon-list").each(function(){$(this).removeClass("current")}),y._EditType=EditMarkerType.NONE,y.position=void 0,y._isSelected=EditMarkerType.NONE,y._selectedEntity=void 0)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){if(y._EditType==EditMarkerType.EMT_HANDLE_MOVE_XY||y._EditType==EditMarkerType.EMT_HANDLE_MOVE_Z){var t=y._viewer.scene.pick(e.position);if(Cesium.defined(t)&&Cesium.defined(t.id)&&Cesium.defined(t.id.billboard)){y.selectedEntity=t.id,y._viewer.scene._screenSpaceCameraController.enableInputs=!1,y._selectedEntity=t.id,y._EditType==EditMarkerType.EMT_HANDLE_MOVE_XY?(y._EditTypeTemp=EditMarkerType.EMT_HANDLE_MOVE_XY,y._isSelected=EditMarkerType.EMT_HANDLE_MOVE_XY):y._EditType==EditMarkerType.EMT_HANDLE_MOVE_Z&&(y._EditTypeTemp=EditMarkerType.EMT_HANDLE_MOVE_Z,y._isSelected=EditMarkerType.EMT_HANDLE_MOVE_Z);var i=y._viewer.scene.pickPosition(e.position);if(Cesium.defined(i)){var n=Cesium.Cartesian3.magnitude(i),a=new Cesium.Cartesian3;a.x=a.y=a.z=n;var s=new Cesium.Ellipsoid;if(y._EditTypeTemp==EditMarkerType.EMT_HANDLE_MOVE_XY){n=Cesium.Cartesian3.magnitude(y._selectedEntity.position._value);y._ellipsoid=new Cesium.Ellipsoid(n,n,n)}else y._ellipsoid=Cesium.Ellipsoid.fromCartesian3(a,s);y.position=i,y.update()}}}},Cesium.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction(function(e){y._drawing=!1},Cesium.ScreenSpaceEventType.RIGHT_CLICK),e.setInputAction(function(e){y._EditTypeTemp=EditMarkerType.NONE,y._viewer.scene._screenSpaceCameraController.enableInputs=!0},Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(e){if((y._isSelected!=EditMarkerType.NONE||y._drawing)&&Cesium.defined(y._selectedEntity)&&(y.position=Cesium.defined(y._selectedEntity.position)?y._selectedEntity.position._value:y._selectedEntity.id.position._value,y.update()),y._EditType!=EditMarkerType.NONE)if(y._EditTypeTemp==EditMarkerType.EMT_HANDLE_MOVE_XY){if(Cesium.defined(y._selectedEntity)&&Cesium.defined(y._selectedEntity.position)){var t=y._viewer.scene.camera.pickEllipsoid(e.endPosition,y._ellipsoid),i=y._viewer.camera.pickEllipsoid(e.startPosition,y._ellipsoid),n=y._viewer.camera.pickEllipsoid(e.endPosition,y._ellipsoid),a=calcDifference(y,i,n),s=Cesium.Cartographic.fromCartesian(y._selectedEntity.position.getValue()),o=Cesium.Cartographic.fromDegrees(a[0],a[1],s.height);t=new Cesium.Cartesian3;Cesium.Cartographic.toCartesian(o,void 0,t),y._selectedEntity.position._value=t,y.position=y._selectedEntity.position._value,y.update()}}else if(y._EditTypeTemp==EditMarkerType.EMT_HANDLE_MOVE_Z&&Cesium.defined(y._selectedEntity)&&Cesium.defined(y._selectedEntity.position)){var l=y._selectedEntity.position._value,r=10;if(l){var d=new Cesium.BoundingRectangle;d.x=0,d.y=0,d.width=y._viewer.scene._context.drawingBufferWidth,d.height=y._viewer.scene._context.drawingBufferHeight;var c=Cesium.Cartographic.fromCartesian(l),p=Cesium.Cartographic.fromRadians(c.longitude,c.latitude,c.height-1),u=Cesium.DEUtility.project(l,y._viewer.scene._camera,d),h=Cesium.DEUtility.project(Cesium.Cartographic.toCartesian(p),y._viewer.scene._camera,d);r=1/(u.y-h.y)}var m=(c=Cesium.Cartographic.fromCartesian(new Cesium.Cartesian3(y._selectedEntity.position._value.x,y._selectedEntity.position._value.y,y._selectedEntity.position._value.z))).height-r*(e.endPosition.y-e.startPosition.y);m<0&&(m=0);var g=Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(c.longitude),Cesium.Math.toDegrees(c.latitude),m);y._selectedEntity.position._value=g,y.position=y._selectedEntity.position._value,y.update()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(){y._isSelected!=EditMarkerType.NONE&&Cesium.defined(y._selectedEntity)&&(y.position=Cesium.defined(y._selectedEntity.position)?y._selectedEntity.position._value:y._selectedEntity.id.position._value,y.update())},Cesium.ScreenSpaceEventType.WHEEL)},PlacePointViewModel.prototype.Start=function(){this._drawing=!0,this.pointImage="".concat(this._viewer._basePath,"/Plugins/assets/dingwei.png")},PlacePointViewModel.prototype.End=function(){var e=this;e._drawing=!1,e._EditType=EditMarkerType.NONE,e._isSelected=EditMarkerType.NONE,e.position=void 0,e.update()},PlacePointViewModel.prototype.LaterallyTranslate=function(e){this._EditType=e},PlacePointViewModel.prototype.UpDownTranslation=function(e){this._EditType=e,this._drawing=!1},PlacePointViewModel.prototype.modifyPointName=function(){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.label)&&(this.selectedEntity.name=this.pointName,this.selectedEntity.label.text=this.pointName,"undefined"!=typeof ACTION&&this.onCreatedEvent.raiseEvent({action:ACTION.UPDATA,type:CONSTANT.DE_Point,value:this.selectedEntity}))},PlacePointViewModel.prototype.modifyAttrInfo=function(){Cesium.defined(this.selectedEntity)&&(this.selectedEntity.info=this.attrInfo)},PlacePointViewModel.prototype.modifyGps=function(){if(Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.billboard)){var e=new Cesium.Cartesian3.fromDegrees(this.pointLongitude,this.pointLatitude,this.pointHeight);this.selectedEntity.pointLatitude=this.pointLatitude,this.selectedEntity.pointLongitude=this.pointLongitude,this.selectedEntity.pointHeight=this.pointHeight,this.selectedEntity.position=e,this.position=e,this.update()}},PlacePointViewModel.prototype.modifyPointImage=function(e){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.billboard)?this.selectedEntity.billboard.image=e:this._drawing=!0,this.pointImage=e,$(".pointIcon-list").each(function(){$(this).removeClass("current")})},PlacePointViewModel.prototype.modifyPointImageColor=function(){if(Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.billboard)){var e=Cesium.Color.fromCssColorString(this.pointImageColor).withAlpha(this.pointImageColorAlpha);this.selectedEntity.billboard.color=e}},PlacePointViewModel.prototype.modifyPointLabelColor=function(){if(Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.label)){var e=Cesium.Color.fromCssColorString(this.pointLabelColor).withAlpha(this.pointLabelColorAlpha);this.selectedEntity.label.fillColor=e}},PlacePointViewModel.prototype.modifyPointImageSize=function(){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.billboard)&&(this.selectedEntity.billboard.width=this.pointImageSize,this.selectedEntity.billboard.height=this.pointImageSize)},PlacePointViewModel.prototype.modifyPointLabelSize=function(){Cesium.defined(this.selectedEntity)&&Cesium.defined(this.selectedEntity.label)&&(this.selectedEntity.label.font=this.pointLabelSize+"px Microsoft YaHei")},PlacePointViewModel.prototype.Edit=function(e){var i=this;this.selectedEntity=e,layui.use("layer",function(){var e=layui.layer;i._layerIndex=e.open({type:1,skin:"dataEarth-viewer-pointLayer",area:"262px",shade:0,anim:0,title:" ",resize:!1,offset:["80px","360px"],content:$(i._element),success:function(){i._viewer.layersManager&&(i._viewer.layersManager.viewModel._layersManagerOverLay="block"),i.Start(),i.initialiseHandlers(),i._removeselectedEntityChanged=i._viewer.selectedEntityChanged.addEventListener(function(e){i.selectedEntity=e})},cancel:function(e,t){i._viewer.layersManager&&(i._viewer.layersManager.viewModel._layersManagerOverLay="none"),i.hidden()}})})},PlacePointViewModel.prototype.hidden=function(){this.End(),Cesium.defined(this._eventHandler)&&0<this._layerIndex&&(layui.layer.close(this._layerIndex),this._layerIndex=0,this._eventHandler.destroy(),this._eventHandler=void 0,this.cleanUp(),this.selectedEntity=null,pointListLayer&&(layui.layer.close(pointListLayer),pointListLayer=void 0),Cesium.defined(this._removeselectedEntityChanged)&&this._removeselectedEntityChanged())},PlacePointViewModel.prototype.Show=function(){var i=this;layui.use("layer",function(){var e=layui.layer;i._layerIndex=e.open({type:1,skin:"dataEarth-viewer-pointLayer",area:"262px",shade:0,anim:0,title:" ",resize:!1,offset:["80px","360px"],content:$(i._element),success:function(){i._viewer.layersManager&&(i._viewer.layersManager.viewModel._layersManagerOverLay="block"),i.Start(),i.initialiseHandlers(),i._removeselectedEntityChanged=i._viewer.selectedEntityChanged.addEventListener(function(e){i.selectedEntity=e})},cancel:function(e,t){i._viewer.layersManager&&(i._viewer.layersManager.viewModel._layersManagerOverLay="none"),i.hidden()}})})};